<!DOCTYPE html>
<html>

<head>

  <title>Realtime Communication Demo</title>
  <link rel="stylesheet" href="css/main.css" />

  <style>
    dialog {
      background: #e8e8e8;
      border: 1px solid #dadada;
      font-family: sans-serif;
      padding: 10px 20px;
      margin-top: 100px;
    }
    
    #local-video {
      height: 100%;
      max-height: 100%;
      max-width: 100%;
      object-fit: cover;
      /* no letterboxing */
      transition: opacity 1s;
      -moz-transform: scale(-1, 1);
      -ms-transform: scale(-1, 1);
      -o-transform: scale(-1, 1);
      -webkit-transform: scale(-1, 1);
      transform: scale(-1, 1);
      width: 100%;
    }
    
    #mini-video {
      border: 1px solid gray;
      bottom: 20px;
      left: 20px;
      /* video div is flipped horizontally when active*/
      max-height: 17%;
      max-width: 17%;
      opacity: 0;
      position: absolute;
      transition: opacity 1s;
    }
    
    #mini-video.active {
      opacity: 1;
      z-index: 2;
    }
    
    #remote-video {
      display: block;
      height: 100%;
      max-height: 100%;
      max-width: 100%;
      object-fit: cover;
      /* no letterboxing */
      opacity: 0;
      position: absolute;
      -moz-transform: rotateY(180deg);
      -ms-transform: rotateY(180deg);
      -o-transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
      transform: rotateY(180deg);
      transition: opacity 1s;
      width: 100%;
    }
    
    #remote-video.active {
      opacity: 1;
      z-index: 1;
    }
  </style>
</head>

<body>

  <dialog id="popupDialog">
    <h3>Input room and user name!</h3>
    <p id="roomLabel">Enter room name:</p>
    <input type="text" style="width: 250px; height: 30px; padding: 5px" id="roomName" value="test" />
    <p id="userLabel">Enter user name:</p>
    <input type="text" style="width: 250px; height: 30px; padding: 5px" id="userName" value="test" />
    <br/>
    <button id="connectBtn" style="margin-left: 100px;margin-top: 20px;width: 100px;height: 30px;" autofocus>Connect</button>
  </dialog>

  <div id="chatScreen" style="display: none;">
    <video id="local-video" autoplay>
    </video>
    <video id="remote-video" autoplay>
    </video>
    <video id="mini-video" autoplay>
    </video>
  </div>

  <!--<button id="stopCall" style="background-color: rgb(255, 15, 0);height: 50px;width: 200px;color: white;font-stretch: bold;font-weight: bold;">Stop Call</button>-->

  <script src="js/lib/adapter.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="js/chatroom.js"></script>
  <script src="js/signaling.js"></script>
  <script src="js/main.js"></script>

  <script type="text/javascript">
    var chatScreen = document.getElementById('chatScreen');  
    var dialog = document.getElementById('popupDialog');  
    var roomInput = document.getElementById('roomName');
    var userInput = document.getElementById('userName');
    var roomLabel = document.getElementById('roomLabel');
    var userLabel = document.getElementById('userLabel');  
    
    document.getElementById('connectBtn').onclick = function() {
        if (roomInput.value != "" && userInput.value != "") {
          startVideoCall(roomInput.value, userInput.value, function (message, error) {
             if(error) {
               alert(error);
               dialog.show();
             } else { 
               chatScreen.style.display = "block";
               dialog.close();
             }
          });
        } else {
          if(roomInput.value == "") {
            roomLabel.style.color = "red";
          } else {
            roomLabel.style.color = "black";
          }
          if(userInput.value == "") {
            userLabel.style.color = "red";
          } else {
            userLabel.style.color = "black";
          }
        }
    };
    
    dialog.show();
  </script>

</body>

</html>