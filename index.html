<!DOCTYPE html>
<html>

<head>

  <title>Realtime Communication Demo</title>
  <link rel="stylesheet" href="css/main.css" />

  <style>
    dialog {
      width: 500px;
      background: #e8e8e8;
      border: 1px solid #dadada;
      font-family: sans-serif;
      padding: 5px 10px 20px 20px;
      margin-top: 50px;
    }
  </style>
</head>

<body>

  <dialog id="popupDialog">
    <h3>Input room and user name!</h3>
    <p id="roomLabel">Enter room name:</p>
    <input type="text" id="roomName" value="test" />
    <p id="userLabel">Enter user name:</p>
    <input type="text" id="userName" value="test" />
    <button id="exit" style="">OK</button>
  </dialog>

  <div id="chatScreen" style="display: none">
    <div style="display: inline-block; width: 500px">
      <div id="displayMsg" style="overflow-y:scroll; height:305px; background-color: #FFEBCD">
      </div>
      <div style="margin-top: 5px">
        <textarea id="inputMsg" style="width: 380px;height: 50px;resize: none" placeholder="Enter some text..."></textarea>
        <button id="videoCall" style="background-color:#00FF3A; height: 55px; width:50px; float:right; margin-left: 5px">Video Call</button>
        <button id="sendMsg" style="background-color:#DADADA; height: 55px; width:50px; float:right">Send Text</button>
      </div>
      <br/>
    </div>
    <div style="display: inline-block; position: absolute">
      <video id="localVideo" style="margin-left: 5px; width:200px" autoplay></video>
      <br/>
      <video id="remoteVideo" style="margin-left: 5px; width:200px" autoplay></video>
    </div>
  </div>

  <script src="http://webrtc.github.io/adapter/adapter-latest.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="js/main.js"></script>

  <script type="text/javascript">
    // createSignallingConnection
	  trace('Created signaling connection');
    createSignalingConnection();
    
    // create room
    var chatScreen = document.getElementById('chatScreen');  
    var dialog = document.getElementById('popupDialog');  
    var roomInput = document.getElementById('roomName');
    var userInput = document.getElementById('userName');
    var roomLabel = document.getElementById('roomLabel');
    var userLabel = document.getElementById('userLabel');  
    
    document.getElementById('exit').onclick = function() {  
        if (roomInput.value != "" && userInput.value != "") {
          createOrJoinRoom(roomInput.value, userInput.value, function (type, message) {
             if(type == "error") {
               alert(message);
               dialog.show();
             } else { 
               chatScreen.style.display = "block";
               dialog.close();
             }
          });
        } else {
          if(roomInput.value == "") {
            roomLabel.style.color = "red";
          } else {
            roomLabel.style.color = "black";
          }
          if(userInput.value == "") {
            userLabel.style.color = "red";
          } else {
            userLabel.style.color = "black";
          }
        }
    };
    
    dialog.show();
  </script>

</body>

</html>